<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resume Preview | CraftMyCareer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/preview.css" />
    <link rel="stylesheet" href="css/responsive.css" />
    <!-- Dynamic Template CSS -->
    <link id="template-css" rel="stylesheet" href="css/template1.css" />
    <script>
      // Immediately apply the selected template
      const selectedTemplate =
        localStorage.getItem("selectedTemplate") || "template1";
      document.getElementById(
        "template-css"
      ).href = `css/${selectedTemplate}.css`;
    </script>
  </head>
  <body>
    <!-- Preview Header -->
    <div class="preview-header">
      <div class="preview-header-left">
        <a href="builder.html" class="btn-back">
          <span class="material-icons">arrow_back</span>
          <span>Back</span>
        </a>
      </div>
      <div class="preview-header-right">
        <button onclick="window.print()" class="btn-download">
          <span class="material-icons">download</span>
          <span>Download PDF</span>
        </button>
      </div>
    </div>

    <!-- Preview Container -->
    <div class="preview-container">
      <div class="a4-page" id="resume-preview">
        <!-- Header -->
        <div class="resume-header">
          <div class="resume-name" id="p-name">YOUR NAME</div>
          <div class="resume-contact" id="p-contact">
            <!-- Contact info will be injected here -->
          </div>
        </div>

        <!-- Summary -->
        <div class="resume-section" id="sec-summary">
          <div class="resume-section-title">SUMMARY</div>
          <div id="p-summary"></div>
        </div>

        <!-- Skills -->
        <div class="resume-section" id="sec-skills">
          <div class="resume-section-title">TECHNICAL SKILLS</div>
          <div class="resume-skills-list" id="p-skills"></div>
        </div>

        <!-- Experience -->
        <div class="resume-section" id="sec-experience">
          <div class="resume-section-title">EXPERIENCE</div>
          <div id="p-experience"></div>
        </div>

        <!-- Projects -->
        <div class="resume-section" id="sec-projects">
          <div class="resume-section-title">PROJECTS</div>
          <div id="p-projects"></div>
        </div>

        <!-- Education -->
        <div class="resume-section" id="sec-education">
          <div class="resume-section-title">EDUCATION</div>
          <div id="p-education"></div>
        </div>

        <!-- Certification -->
        <div class="resume-section" id="sec-certification">
          <div class="resume-section-title">CERTIFICATION</div>
          <div id="p-certification"></div>
        </div>
      </div>
    </div>

    <script src="js/themeToggle.js"></script>
    <script>
      // Load and render resume data
      function renderResume() {
        const data = JSON.parse(localStorage.getItem("resumeData")) || {};

        // Name
        if (data.fullName) {
          document.getElementById("p-name").textContent =
            data.fullName.toUpperCase();
        }

        // Contact Info
        const contactDiv = document.getElementById("p-contact");
        contactDiv.innerHTML = "";

        if (data.email) {
          contactDiv.innerHTML += `<div class="resume-contact-item"><span class="material-icons" style="font-size: 1rem;">email</span> ${data.email}</div>`;
        }
        if (data.phone) {
          contactDiv.innerHTML += `<div class="resume-contact-item"><span class="material-icons" style="font-size: 1rem;">phone</span> ${data.phone}</div>`;
        }
        if (data.location) {
          contactDiv.innerHTML += `<div class="resume-contact-item"><span class="material-icons" style="font-size: 1rem;">location_on</span> ${data.location}</div>`;
        }

        // Social Links
        if (data.socialLinks && data.socialLinks.length > 0) {
          data.socialLinks.forEach((link) => {
            if (link.platform && link.url) {
              contactDiv.innerHTML += `<div class="resume-contact-item"><span class="material-icons" style="font-size: 1rem;">link</span> <a href="${link.url}" target="_blank" style="color: inherit;">${link.platform}</a></div>`;
            }
          });
        }

        // Summary
        if (data.summary) {
          document.getElementById("p-summary").innerHTML = data.summary.replace(
            /\n/g,
            "<br>"
          );
          document.getElementById("sec-summary").style.display = "block";
        } else {
          document.getElementById("sec-summary").style.display = "none";
        }

        // Skills
        if (data.skills && data.skills.length > 0) {
          document.getElementById("p-skills").innerHTML = data.skills
            .map((skill) => `<span class="resume-skill-tag">${skill}</span>`)
            .join("");
          document.getElementById("sec-skills").style.display = "block";
        } else {
          document.getElementById("sec-skills").style.display = "none";
        }

        // Experience
        if (data.experience && data.experience.length > 0) {
          document.getElementById("p-experience").innerHTML = data.experience
            .map(
              (exp) => `
            <div class="resume-item">
              <div class="resume-item-header">
                <div class="resume-item-title">${exp.title || ""}</div>
                <div class="resume-item-date">${exp.startDate || ""} - ${
                exp.endDate || ""
              }</div>
              </div>
              <div class="resume-item-subtitle">${exp.company || ""}</div>
              <div class="resume-item-description">${(
                exp.description || ""
              ).replace(/\n/g, "<br>")}</div>
            </div>
          `
            )
            .join("");
          document.getElementById("sec-experience").style.display = "block";
        } else {
          document.getElementById("sec-experience").style.display = "none";
        }

        // Projects
        if (data.projects && data.projects.length > 0) {
          document.getElementById("p-projects").innerHTML = data.projects
            .map(
              (proj) => `
            <div class="resume-item">
              <div class="resume-item-header">
                <div class="resume-item-title">${proj.name || ""}</div>
                <div class="resume-item-date">${proj.date || ""}</div>
              </div>
              ${
                proj.link
                  ? `<div class="resume-item-subtitle"><a href="${proj.link}" target="_blank" style="color: inherit;">${proj.link}</a></div>`
                  : ""
              }
              <div class="resume-item-description">${(
                proj.description || ""
              ).replace(/\n/g, "<br>")}</div>
            </div>
          `
            )
            .join("");
          document.getElementById("sec-projects").style.display = "block";
        } else {
          document.getElementById("sec-projects").style.display = "none";
        }

        // Education
        if (data.education && data.education.length > 0) {
          document.getElementById("p-education").innerHTML = data.education
            .map(
              (edu) => `
            <div class="resume-item">
              <div class="resume-item-header">
                <div class="resume-item-title">${edu.degree || ""}</div>
                <div class="resume-item-date">${edu.startYear || ""} - ${
                edu.endYear || ""
              }</div>
              </div>
              <div class="resume-item-subtitle">${edu.institution || ""}</div>
              ${
                edu.gpa
                  ? `<div style="color: #666; font-size: 0.9rem;">GPA: ${edu.gpa}</div>`
                  : ""
              }
            </div>
          `
            )
            .join("");
          document.getElementById("sec-education").style.display = "block";
        } else {
          document.getElementById("sec-education").style.display = "none";
        }

        // Certification
        if (data.certification && data.certification.length > 0) {
          document.getElementById("p-certification").innerHTML =
            data.certification
              .map(
                (cert) => `
            <div class="resume-item">
              <div class="resume-item-header">
                <div class="resume-item-title">${cert.name || ""}</div>
                <div class="resume-item-date">${cert.date || ""}</div>
              </div>
              <div class="resume-item-subtitle">${cert.issuer || ""}</div>
            </div>
          `
              )
              .join("");
          document.getElementById("sec-certification").style.display = "block";
        } else {
          document.getElementById("sec-certification").style.display = "none";
        }
      }

      // Render on load
      document.addEventListener("DOMContentLoaded", renderResume);
    </script>
  </body>
</html>
